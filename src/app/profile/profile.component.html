<div class="profile-container">
  <!-- Notification Modal -->
  <app-notification-modal
    [message]="notificationMessage"
    [type]="notificationType"
    [visible]="notificationVisible"
    (close)="closeNotification()"
  ></app-notification-modal>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-spinner">
    <p>Äang táº£i thÃ´ng tin...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-message">
    <p>{{ error }}</p>
    <button (click)="loadUserProfile()" class="btn btn-primary">Thá»­ láº¡i</button>
  </div>

  <!-- Profile Content -->
  <div *ngIf="user && !loading" class="profile-content">
    <!-- Header -->
    <div class="profile-header">
      <div class="header-content">
        <h1>{{ user.name }}</h1>
        <p class="user-email">{{ user.email }}</p>
        <div class="header-info">
          <span>ğŸ‘¤ ThÃ nh viÃªn tá»« {{ formatDate(user.createdAt) }}</span>
          <span>|</span>
          <span>ğŸ• Láº§n Ä‘Äƒng nháº­p cuá»‘i: {{ formatDateTime(user.lastLogin) }}</span>
        </div>
      </div>
      <button (click)="logout()" class="btn btn-danger logout-btn">
        ğŸ“¤ ÄÄƒng xuáº¥t
      </button>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs-navigation">
      <button
        (click)="setActiveTab('info')"
        [class.active]="activeTab === 'info'"
        class="tab-btn"
      >
        ğŸ“‹ ThÃ´ng tin cÃ¡ nhÃ¢n
      </button>
      <button
        (click)="setActiveTab('purchases')"
        [class.active]="activeTab === 'purchases'"
        class="tab-btn"
      >
        ğŸ›ï¸ áº¢nh Ä‘Ã£ mua
      </button>
      <button
        (click)="setActiveTab('sales')"
        [class.active]="activeTab === 'sales'"
        class="tab-btn"
      >
        ğŸ“¸ áº¢nh Ä‘Ã£ bÃ¡n
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Personal Info Tab -->
      <div *ngIf="activeTab === 'info'" class="tab-pane">
        <!-- User Information Box -->
        <div class="info-box">
          <h2>ğŸ“‹ ThÃ´ng tin cÃ¡ nhÃ¢n</h2>
          
          <div class="form-group">
            <label for="username">TÃªn ngÆ°á»i dÃ¹ng</label>
            <input 
              id="username"
              type="text" 
              [value]="user.name" 
              readonly
              class="form-input"
            />
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input 
              id="email"
              type="email" 
              [value]="user.email" 
              readonly
              class="form-input"
            />
          </div>

          <div class="form-group">
            <label for="password">Máº­t kháº©u</label>
            <div class="password-group">
              <input 
                id="password"
                type="password" 
                value="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" 
                readonly
                class="form-input"
              />
              <button 
                (click)="toggleChangePassword()"
                class="btn btn-change-password"
              >
                ğŸ” Äá»•i máº­t kháº©u
              </button>
            </div>
          </div>

          <!-- Change Password Form -->
          <div *ngIf="showChangePassword" class="change-password-form">
            <div class="form-divider"></div>
            <h3>Äá»•i máº­t kháº©u</h3>

            <div class="form-group">
              <label for="current-password">Máº­t kháº©u hiá»‡n táº¡i</label>
              <input
                id="current-password"
                type="password"
                [(ngModel)]="currentPassword"
                placeholder="Nháº­p máº­t kháº©u hiá»‡n táº¡i"
                [disabled]="changePasswordLoading"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label for="new-password">Máº­t kháº©u má»›i</label>
              <input
                id="new-password"
                type="password"
                [(ngModel)]="newPassword"
                placeholder="Nháº­p máº­t kháº©u má»›i"
                [disabled]="changePasswordLoading"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label for="confirm-password">XÃ¡c nháº­n máº­t kháº©u</label>
              <input
                id="confirm-password"
                type="password"
                [(ngModel)]="confirmPassword"
                placeholder="XÃ¡c nháº­n máº­t kháº©u má»›i"
                [disabled]="changePasswordLoading"
                class="form-input"
              />
            </div>

            <p class="error" *ngIf="changePasswordError">
              {{ changePasswordError }}
            </p>
            <p class="message-success" *ngIf="changePasswordMessage">
              {{ changePasswordMessage }}
            </p>

            <div class="form-actions">
              <button
                (click)="changePassword()"
                class="btn btn-primary"
                [disabled]="changePasswordLoading"
              >
                {{ changePasswordLoading ? 'Äang xá»­ lÃ½...' : 'âœ… Äá»•i máº­t kháº©u' }}
              </button>
              <button
                (click)="toggleChangePassword()"
                class="btn btn-outline"
                [disabled]="changePasswordLoading"
              >
                âŒ Há»§y
              </button>
            </div>
          </div>
        </div>

        <!-- Account & Payment Box -->
        <div class="account-box">
          <h2>ğŸ’° TÃ i khoáº£n & Thanh toÃ¡n</h2>
          
          <div class="account-info">
            <div class="info-item">
              <label>Sá»‘ dÆ° tÃ i khoáº£n</label>
              <div class="balance-display">
                <span class="balance-value">0 VNÄ</span>
                <small>Sáº½ Ä‘Æ°á»£c cáº­p nháº­t khi cÃ³ giao dá»‹ch</small>
              </div>
            </div>

            <div class="info-item">
              <label>PhÆ°Æ¡ng thá»©c thanh toÃ¡n</label>
              <div class="payment-methods">
                <div class="method-item">
                  <input type="radio" id="card" name="payment" value="card" disabled />
                  <label for="card">ğŸ’³ Tháº» tÃ­n dá»¥ng</label>
                </div>
                <div class="method-item">
                  <input type="radio" id="vnpay" name="payment" value="vnpay" disabled />
                  <label for="vnpay">ğŸ¦ VNPay</label>
                </div>
                <div class="method-item">
                  <input type="radio" id="bank" name="payment" value="bank" disabled />
                  <label for="bank">ğŸ§ Chuyá»ƒn khoáº£n ngÃ¢n hÃ ng</label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Purchases Tab -->
      <div *ngIf="activeTab === 'purchases'" class="tab-pane">
        <div class="purchases-section">
          <h2>ğŸ›ï¸ áº¢nh Ä‘Ã£ mua</h2>
          
          <div *ngIf="purchasesLoading" class="loading-state">
            <p>Äang táº£i áº£nh Ä‘Ã£ mua...</p>
          </div>
          
          <div *ngIf="!purchasesLoading && purchases.length === 0" class="empty-state">
            <p>Báº¡n chÆ°a mua áº£nh nÃ o</p>
            <button class="btn btn-primary" routerLink="/library">
              Mua sáº¯m ngay
            </button>
          </div>

          <div *ngIf="!purchasesLoading && purchases.length > 0" class="gallery-grid">
            <div *ngFor="let purchase of purchases" class="gallery-item">
              <div class="gallery-image-wrapper">
                <img 
                  [src]="purchase.productData?.image || '/assets/placeholder.svg'" 
                  [alt]="purchase.productData?.title"
                  onError="this.src='/assets/placeholder.svg'"
                  class="gallery-image"
                />
              </div>
              <div class="gallery-info">
                <h3>{{ purchase.productData?.title }}</h3>
                <p class="purchase-date">Mua: {{ formatDate(purchase.createdAt) }}</p>
                <p class="purchase-price">{{ purchase.productData?.price | currency: 'VND' }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sales Tab -->
      <div *ngIf="activeTab === 'sales'" class="tab-pane">
        <div class="sales-section">
          <h2>ğŸ“¸ áº¢nh Ä‘Ã£ bÃ¡n</h2>
          
          <div *ngIf="salesLoading" class="loading-state">
            <p>Äang táº£i áº£nh Ä‘Ã£ bÃ¡n...</p>
          </div>
          
          <div *ngIf="!salesLoading && sales.length === 0" class="empty-state">
            <p>Báº¡n chÆ°a bÃ¡n áº£nh nÃ o</p>
            <button class="btn btn-primary" routerLink="/library">
              Táº£i lÃªn áº£nh
            </button>
          </div>

          <div *ngIf="!salesLoading && sales.length > 0" class="gallery-grid">
            <div *ngFor="let sale of sales" class="gallery-item">
              <div class="gallery-image-wrapper">
                <img 
                  [src]="sale.productData?.image || '/assets/placeholder.svg'" 
                  [alt]="sale.productData?.title"
                  onError="this.src='/assets/placeholder.svg'"
                  class="gallery-image"
                />
              </div>
              <div class="gallery-info">
                <h3>{{ sale.productData?.title }}</h3>
                <p class="sale-date">BÃ¡n: {{ formatDate(sale.createdAt) }}</p>
                <p class="sale-price">{{ sale.productData?.price | currency: 'VND' }}</p>
                <p class="buyer">NgÆ°á»i mua: {{ sale.buyerId.name }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
